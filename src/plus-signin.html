<link rel="import" href="../bower_components/polymer/polymer.html">

<!--
*
* Google+ Sign-in button for authenticating with Google Services
* inside a Polymer element. Note that a valid clientId is
* required to use the element, which can be obtained from the
* Google Developer console.
*
* Copyright 2014 Google Inc. All Rights Reserved.
*
* @author: Addy Osmani
*
-->

<!--
/*
* plus-signin-button
*
* A Polymer helper element for firing events when a user is logged
* in to G+. To be used alongside plus-signin
 */
-->
<polymer-element name="plus-signin-button" attributes="loggedin">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
    </template>
    <script>
        /**
         * A Polymer element which fires a 'plus-signed-in' event
         * on successfully logging in to Google+.
         */
        Polymer('plus-signin-button', {
            loggedinChanged: function () {
                console.log('Google+ Signed In Successfully.');
                this.fire('plus-signed-in');
            }
        });
    </script>
</polymer-element>

<!--
/*
* plus-signin: A Polymer element for authorizing with Google+
* 
* Pass it a valid clientId (retrieved from your Google Developer Console)
* in order for the sign-in callback to correctly function.
 */
-->
<polymer-element name="plus-signin" attributes="clientId">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <plus-signin-button id="signin" loggedin="false"></plus-signin-button>
    </template>
    <script>
        var accessToken = null;

        /**
         * A callback executed by the Google+ Auth service
         * @param result
         */
        function signinCallback(result) {

            if (result.access_token) {
                accessToken = result.access_token;

                var signInButton = document.getElementById("___signin_0");

                // Trigger the plus-signed-in event
                signInButton.setAttribute("loggedin", "true");

                // Hide the sign-in button once authorized
                signInButton.style.display = "none";
            }
        }

        /**
         * A simple Polymer element for injecting the G+ client API
         * script into an element in order to interact with the sign
         * in process.
         */
        Polymer('plus-signin', {
            clientId: '',
            ready: function () {
                if(this.clientId === ''){
                    throw "A valid clientId is required to use this element";
                }
                var script = document.createElement("script");
                var body = document.body;
                var div = document.createElement("div");

                script.setAttribute("type", "text/javascript");
                script.setAttribute("src", "https://apis.google.com/js/client:plusone.js");
                script.setAttribute("async", true);
                script.innerHTML = "{lang: 'en-us'}";

                div.setAttribute("class", "g-signin");
                div.setAttribute("data-callback", "signinCallback");
                div.setAttribute("data-clientid", this.clientId);
                div.setAttribute("data-cookiepolicy", "single_host_origin");
                div.setAttribute("data-scope", "https://www.googleapis.com/auth/drive.file");
                body.appendChild(div);
                body.appendChild(script);
            }
        });
    </script>
</polymer-element>