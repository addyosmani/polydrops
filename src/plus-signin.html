<link rel="import" href="../bower_components/polymer/polymer.html">

<!--
* Copyright (c) 2014 Google Inc. All rights reserved.
* This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE
*
* Google+ Sign-in button for authenticating with Google Services inside a Polymer element. Note that a
* valid clientId is required to use the element, which can be obtained from the Google Developer console.
*
* @author: Addy Osmani
*
-->

<!--
/*
* plus-signin-button
*
* A Polymer helper element for firing events when a user is logged in to G+. To be used alongside plus-signin.
* Use the attribute 'loggedin' is used to indicate when a user is logged in or logged out.
*
* Example:
*    <plus-signin-button loggedin="false">
*    </plus-signin-button>
*
* @element: plus-signin-button
* @homepage: github.io
*/
-->
<polymer-element name="plus-signin-button" attributes="loggedin">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
    </template>
    <script>
        /**
         * A Polymer element which fires a 'plus-signed-in' event
         * on successfully logging in to Google+.
         */
        Polymer('plus-signin-button', {
            loggedinChanged: function () {
                console.log('Google+ Signed In Successfully.');
                this.fire('plus-signed-in');
            }
        });
    </script>
</polymer-element>

<!--
/*
* plus-signin
*
* A Polymer element for authenticating with Google+/Google Services.
*
* Example:
*    <plus-signin cliendId="..."></plus-signin>
*
* Use the `clientId` attribute (retrieved from your Google Developer Console) in order to correctly
* connect with the Google+ API. On successfully logging in, the `plus-signed-in` event from the
* <plus-signin-button> will be fired.
*/
-->
<polymer-element name="plus-signin" attributes="clientId">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <plus-signin-button id="signin" loggedin="false"></plus-signin-button>
    </template>
    <script>
        var accessToken = null;

        /**
         * A callback executed by the Google+ Auth service
         * @param result
         */
        function signinCallback(result) {

            if (result.access_token) {
                accessToken = result.access_token;

                var signInButton = document.getElementById("___signin_0");

                // Trigger the plus-signed-in event
                signInButton.setAttribute("loggedin", "true");

                // Hide the sign-in button once authorized
                signInButton.style.display = "none";
            }
        }

        /**
         * A simple Polymer element for injecting the G+ client API
         * script into an element in order to interact with the sign
         * in process.
         */
        Polymer('plus-signin', {
            clientId: '',
            ready: function () {
                if(this.clientId === ''){
                    throw "A valid clientId is required to use this element";
                }
                var script = document.createElement("script");
                var body = document.body;
                var div = document.createElement("div");

                script.setAttribute("type", "text/javascript");
                script.setAttribute("src", "https://apis.google.com/js/client:plusone.js");
                script.setAttribute("async", true);
                script.innerHTML = "{lang: 'en-us'}";

                div.setAttribute("class", "g-signin");
                div.setAttribute("data-callback", "signinCallback");
                div.setAttribute("data-clientid", this.clientId);
                div.setAttribute("data-cookiepolicy", "single_host_origin");
                div.setAttribute("data-scope", "https://www.googleapis.com/auth/drive.file");
                body.appendChild(div);
                body.appendChild(script);
            }
        });
    </script>
</polymer-element>